<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AdGuard DNSè§„åˆ™æ•´ç†å·¥å…·ï¼ˆç²¾ç»†åŒ–åˆ†ç±»ç‰ˆï¼‰</title>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', 'Microsoft YaHei', sans-serif;
        }
        
        body {
            background-color: #f5f7fa;
            color: #333;
            line-height: 1.6;
            padding: 20px;
            max-width: 1800px;
            margin: 0 auto;
        }
        
        .container {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }
        
        header {
            text-align: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid #ddd;
        }
        
        h1 {
            color: #2c3e50;
            margin-bottom: 10px;
        }
        
        .subtitle {
            color: #7f8c8d;
            font-size: 1.1rem;
        }
        
        .toolbar {
            background-color: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
        }
        
        .toolbar h2 {
            color: #3498db;
            margin-bottom: 15px;
            font-size: 1.3rem;
        }
        
        .file-upload {
            margin-bottom: 20px;
            padding: 15px;
            border: 2px dashed #3498db;
            border-radius: 8px;
            text-align: center;
            background-color: #f8fafc;
        }
        
        .file-upload label {
            display: block;
            cursor: pointer;
            padding: 10px;
            color: #3498db;
            font-weight: 600;
        }
        
        .file-upload input {
            display: none;
        }
        
        .file-list {
            margin-top: 10px;
            padding: 10px;
            background-color: #fff;
            border-radius: 6px;
            max-height: 150px;
            overflow-y: auto;
            text-align: left;
            font-size: 0.9rem;
            color: #555;
        }
        
        .options {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .option-group {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        
        .option-group label {
            display: flex;
            align-items: center;
            gap: 8px;
            font-weight: 500;
        }
        
        .option-group input[type="checkbox"] {
            width: 18px;
            height: 18px;
        }
        
        /* åˆ†ç±»é…ç½®æ ·å¼ - é€‚é…å¤šçº§åˆ†ç±» */
        .category-config {
            margin: 20px 0;
            padding: 15px;
            background-color: #f8fafc;
            border-radius: 8px;
            border: 1px solid #e3e8ee;
        }
        
        .category-config h3 {
            color: #2c3e50;
            margin-bottom: 10px;
            font-size: 1.1rem;
        }
        
        .category-config .tips {
            font-size: 0.85rem;
            color: #666;
            margin-bottom: 10px;
            padding: 8px;
            background-color: #e8f4fd;
            border-radius: 4px;
        }
        
        /* å¤šçº§åˆ†ç±»åˆ†ç»„æ ·å¼ */
        .category-group {
            margin: 15px 0;
            padding: 10px;
            background-color: #fff;
            border-radius: 6px;
            border-left: 4px solid #3498db;
        }
        
        .category-group h4 {
            color: #2c3e50;
            margin-bottom: 8px;
            font-size: 1rem;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .category-list {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 10px;
            margin: 10px 0;
        }
        
        .category-item {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px;
            background-color: #f9f9f9;
            border-radius: 4px;
            border: 1px solid #eee;
        }
        
        .category-item input {
            flex: 1;
            padding: 5px;
            border: 1px solid #eee;
            border-radius: 4px;
            font-size: 0.9rem;
        }
        
        .add-category-btn {
            background-color: #27ae60;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.9rem;
            margin-top: 10px;
        }
        
        .progress-container {
            margin: 20px 0;
            background-color: #ecf0f1;
            border-radius: 8px;
            overflow: hidden;
            height: 24px;
        }
        
        .progress-bar {
            height: 100%;
            background: linear-gradient(90deg, #3498db, #2ecc71);
            width: 0%;
            transition: width 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            font-size: 0.9rem;
        }
        
        .stats {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            background-color: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin-top: 15px;
        }
        
        .stat-item {
            flex: 1;
            min-width: 150px;
            text-align: center;
            padding: 10px;
            background-color: white;
            border-radius: 6px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
        }
        
        .stat-number {
            font-size: 1.8rem;
            font-weight: bold;
            color: #2c3e50;
        }
        
        .stat-label {
            font-size: 0.9rem;
            color: #7f8c8d;
            margin-top: 5px;
        }
        
        .search-container {
            margin-top: 20px;
            display: flex;
            gap: 10px;
            align-items: center;
            flex-wrap: wrap;
        }
        
        .search-input {
            flex: 1;
            min-width: 200px;
            padding: 10px 15px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 1rem;
        }
        
        .search-type {
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 6px;
            background-color: white;
        }
        
        .btn {
            padding: 10px 20px;
            background-color: #3498db;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            transition: background-color 0.2s;
        }
        
        .btn:hover {
            background-color: #2980b9;
        }
        
        .btn:disabled {
            background-color: #bdc3c7;
            cursor: not-allowed;
        }
        
        .content-display {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
            margin-top: 20px;
        }
        
        .content-panel {
            background-color: white;
            border-radius: 10px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }
        
        .panel-header {
            background-color: #2c3e50;
            color: white;
            padding: 15px;
            font-weight: 600;
            font-size: 1.1rem;
        }
        
        .content-area {
            flex: 1;
            padding: 15px;
            overflow-y: auto;
            max-height: 500px;
            font-family: 'Consolas', 'Monaco', 'Courier New', monospace;
            font-size: 0.9rem;
            line-height: 1.5;
            white-space: pre-wrap;
            word-wrap: break-word;
            background-color: #f8f9fa;
        }
        
        /* åˆ†ç±»æ ‡é¢˜æ ·å¼ */
        .category-title {
            color: #e74c3c;
            font-weight: bold;
            margin: 10px 0 5px 0;
            font-size: 1rem;
        }
        
        /* ä¸åŒç±»å‹è§„åˆ™é«˜äº®æ ·å¼ */
        .rule-ad { color: #e67e22; }          /* å¹¿å‘Šç›¸å…³ */
        .rule-tracking { color: #9b59b6; }    /* è·Ÿè¸ªç›¸å…³ */
        .rule-social { color: #3498db; }      /* ç¤¾äº¤ç›¸å…³ */
        .rule-security { color: #e74c3c; }    /* å®‰å…¨é˜²æŠ¤ */
        .rule-content { color: #8e44ad; }     /* å†…å®¹è¿‡æ»¤ */
        .rule-privacy { color: #16a085; }     /* éšç§ä¿æŠ¤ */
        .rule-media { color: #f39c12; }       /* åª’ä½“å†…å®¹ */
        .rule-info { color: #27ae60; }        /* ä¿¡æ¯è·å– */
        .rule-system { color: #7f8c8d; }      /* ç³»ç»Ÿç›¸å…³ */
        .rule-region { color: #d35400; }      /* åœ°åŒºç‰¹å®š */
        .rule-general { color: #2c3e50; }     /* é€šç”¨è§„åˆ™ */
        
        .highlight {
            background-color: #fffacd;
            padding: 2px 0;
        }
        
        .match-count {
            margin-left: 10px;
            background-color: #e74c3c;
            color: white;
            padding: 2px 8px;
            border-radius: 10px;
            font-size: 0.8rem;
        }
        
        footer {
            margin-top: 30px;
            text-align: center;
            color: #7f8c8d;
            font-size: 0.9rem;
            padding-top: 15px;
            border-top: 1px solid #ddd;
        }
        
        @media (max-width: 1200px) {
            .content-display {
                grid-template-columns: 1fr;
            }
        }
        
        @media (max-width: 768px) {
            .options {
                grid-template-columns: 1fr;
            }
            
            .category-list {
                grid-template-columns: 1fr;
            }
            
            .stats {
                flex-direction: column;
            }
            
            .search-container {
                flex-direction: column;
                align-items: stretch;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>AdGuard DNSè§„åˆ™æ•´ç†å·¥å…·ï¼ˆç²¾ç»†åŒ–åˆ†ç±»ç‰ˆï¼‰</h1>
            <p class="subtitle">åŸºäºå¹¿å‘Š/ç¤¾äº¤/å®‰å…¨/éšç§ç­‰åå¤§ç±»ç»†åˆ†ï¼Œè‡ªåŠ¨åˆå¹¶ã€å»é‡ã€åˆ†ç±»AdGuard DNSè§„åˆ™</p>
        </header>
        
        <div class="toolbar">
            <h2>æ–‡ä»¶ä¸Šä¼ ä¸å¤„ç†é€‰é¡¹</h2>
            
            <div class="file-upload">
                <label for="fileInput">
                    <span style="font-size: 3rem; display: block; margin-bottom: 10px;">ğŸ“„</span>
                    ç‚¹å‡»é€‰æ‹©å¤šä¸ªTXT/è§„åˆ™æ–‡ä»¶æˆ–æ‹–æ”¾æ–‡ä»¶åˆ°æ­¤å¤„
                    <br>
                    <span style="font-size: 0.9rem; color: #7f8c8d;">æ”¯æŒAdGuard DNSè§„åˆ™ã€å¤šæ–‡ä»¶åˆå¹¶ã€ç²¾ç»†åŒ–åˆ†ç±»ã€å¤§æ–‡ä»¶å¤„ç†</span>
                </label>
                <input type="file" id="fileInput" accept=".txt,.filter,.rules" multiple>
                <div class="file-list" id="fileList">æœªé€‰æ‹©æ–‡ä»¶</div>
            </div>
            
            <div class="options">
                <div class="option-group">
                    <h3>åŸºç¡€å¤„ç†é€‰é¡¹</h3>
                    <label>
                        <input type="checkbox" id="removeDuplicates" checked>
                        å»é™¤é‡å¤è§„åˆ™è¡Œ
                    </label>
                    <label>
                        <input type="checkbox" id="removeComments" checked>
                        å»é™¤!å¼€å¤´çš„æ³¨é‡Šè¡Œ
                    </label>
                    <label>
                        <input type="checkbox" id="sortLines">
                        æŒ‰åŸŸåæ’åºè§„åˆ™
                    </label>
                    <label>
                        <input type="checkbox" id="enableCategory" checked>
                        å¯ç”¨ç²¾ç»†åŒ–è‡ªåŠ¨åˆ†ç±»
                    </label>
                </div>
                
                <div class="option-group">
                    <h3>AdGuardä¸“å±é€‰é¡¹</h3>
                    <label>
                        <input type="checkbox" id="trimLines" checked>
                        å»é™¤è§„åˆ™é¦–å°¾ç©ºæ ¼/æ¢è¡Œ
                    </label>
                    <label>
                        <input type="checkbox" id="removeEmptyLines" checked>
                        å»é™¤ç©ºè¡Œ
                    </label>
                    <label>
                        <input type="checkbox" id="keepRuleSyntax" checked>
                        ä¿ç•™AdGuardè§„åˆ™è¯­æ³•ï¼ˆ|| ^ $ç­‰ï¼‰
                    </label>
                    <label>
                        <input type="checkbox" id="sortByCategory">
                        æŒ‰åˆ†ç±»åç§°æ’åº
                    </label>
                </div>
            </div>
            
            <!-- ç²¾ç»†åŒ–åˆ†ç±»é…ç½®åŒºåŸŸ -->
            <div class="category-config">
                <h3>AdGuardè§„åˆ™ç²¾ç»†åŒ–åˆ†ç±»é…ç½®ï¼ˆåå¤§ç±»ï¼‰</h3>
                <div class="tips">
                    ğŸ“Œ é€‚é…AdGuardè§„åˆ™æ ¼å¼ï¼š||domain^ã€@@ç™½åå•ã€$ä¿®é¥°ç¬¦ç­‰<br>
                    ğŸ“Œ å…³é”®è¯åŒ¹é…ä¼˜å…ˆçº§ï¼šè¯­æ³•ç‰¹å¾ > åŸŸåå…³é”®è¯ > è§„åˆ™å†…å®¹<br>
                    ğŸ“Œ åˆ†ç±»ä½“ç³»ï¼šå¹¿å‘Šä¸è·Ÿè¸ª â†’ ç¤¾äº¤åª’ä½“ â†’ å®‰å…¨é˜²æŠ¤ â†’ å†…å®¹è¿‡æ»¤ â†’ éšç§ä¿æŠ¤ â†’ åª’ä½“å†…å®¹ â†’ ä¿¡æ¯è·å– â†’ ç³»ç»Ÿç›¸å…³ â†’ åœ°åŒºç‰¹å®š â†’ é€šç”¨
                </div>
                
                <!-- 1. å¹¿å‘Šä¸è·Ÿè¸ªåˆ†ç±»ç»„ -->
                <div class="category-group">
                    <h4>ğŸ“¢ å¹¿å‘Šä¸è·Ÿè¸ª</h4>
                    <div class="category-list" id="categoryListAd">
                        <div class="category-item">
                            <span>ğŸš«</span>
                            <input type="text" value="å¹¿å‘Šæ‹¦æˆª" placeholder="åˆ†ç±»åç§°" class="category-name">
                            <span>|</span>
                            <input type="text" value="ad,ads,advert,å¹¿å‘Š,æ¨å¹¿,æ¨ªå¹…,å¼¹çª—,$adblock,$advertising" placeholder="å…³é”®è¯" class="category-keys">
                        </div>
                        <div class="category-item">
                            <span>ğŸ•µï¸</span>
                            <input type="text" value="è·Ÿè¸ªä¿æŠ¤" placeholder="åˆ†ç±»åç§°" class="category-name">
                            <span>|</span>
                            <input type="text" value="tracker,tracking,è·Ÿè¸ª,ç›‘æ§,analytics,ç»Ÿè®¡,$tracker,$analytics" placeholder="å…³é”®è¯" class="category-keys">
                        </div>
                        <div class="category-item">
                            <span>ğŸªŸ</span>
                            <input type="text" value="å¼¹çª—å¹¿å‘Š" placeholder="åˆ†ç±»åç§°" class="category-name">
                            <span>|</span>
                            <input type="text" value="popup,pop-up,å¼¹çª—,æ‚¬æµ®çª—,å¼¹çª—å¹¿å‘Š,$popup" placeholder="å…³é”®è¯" class="category-keys">
                        </div>
                    </div>
                </div>
                
                <!-- 2. ç¤¾äº¤åª’ä½“åˆ†ç±»ç»„ -->
                <div class="category-group">
                    <h4>ğŸ‘¥ ç¤¾äº¤åª’ä½“</h4>
                    <div class="category-list" id="categoryListSocial">
                        <div class="category-item">
                            <span>ğŸ“±</span>
                            <input type="text" value="ç¤¾äº¤åª’ä½“" placeholder="åˆ†ç±»åç§°" class="category-name">
                            <span>|</span>
                            <input type="text" value="wechat,å¾®ä¿¡,qq,å¾®åš,facebook,twitter,instagram,æŠ–éŸ³,å¿«æ‰‹,$social" placeholder="å…³é”®è¯" class="category-keys">
                        </div>
                        <div class="category-item">
                            <span>ğŸ”Œ</span>
                            <input type="text" value="ç¤¾äº¤æ’ä»¶" placeholder="åˆ†ç±»åç§°" class="category-name">
                            <span>|</span>
                            <input type="text" value="social,plugin,æ’ä»¶,åˆ†äº«,è¯„è®º,ç¤¾äº¤ç»„ä»¶,$socialplugin" placeholder="å…³é”®è¯" class="category-keys">
                        </div>
                    </div>
                </div>
                
                <!-- 3. å®‰å…¨é˜²æŠ¤åˆ†ç±»ç»„ -->
                <div class="category-group">
                    <h4>ğŸ›¡ï¸ å®‰å…¨é˜²æŠ¤</h4>
                    <div class="category-list" id="categoryListSecurity">
                        <div class="category-item">
                            <span>ğŸ¦ </span>
                            <input type="text" value="æ¶æ„è½¯ä»¶" placeholder="åˆ†ç±»åç§°" class="category-name">
                            <span>|</span>
                            <input type="text" value="malware,ç—…æ¯’,æ¶æ„è½¯ä»¶,æœ¨é©¬,$malware,$virus" placeholder="å…³é”®è¯" class="category-keys">
                        </div>
                        <div class="category-item">
                            <span>ğŸ£</span>
                            <input type="text" value="é’“é±¼ç½‘ç«™" placeholder="åˆ†ç±»åç§°" class="category-name">
                            <span>|</span>
                            <input type="text" value="phishing,é’“é±¼,ä»¿å†’,æ¬ºè¯ˆ,$phishing,$fraud" placeholder="å…³é”®è¯" class="category-keys">
                        </div>
                        <div class="category-item">
                            <span>â›ï¸</span>
                            <input type="text" value="æŒ–çŸ¿è„šæœ¬" placeholder="åˆ†ç±»åç§°" class="category-name">
                            <span>|</span>
                            <input type="text" value="mining,æŒ–çŸ¿,åŠ å¯†è´§å¸,æ¯”ç‰¹å¸,ethereum,$mining,$crypto" placeholder="å…³é”®è¯" class="category-keys">
                        </div>
                    </div>
                </div>
                
                <!-- 4. å†…å®¹è¿‡æ»¤åˆ†ç±»ç»„ -->
                <div class="category-group">
                    <h4>ğŸ” å†…å®¹è¿‡æ»¤</h4>
                    <div class="category-list" id="categoryListContent">
                        <div class="category-item">
                            <span>ğŸ”</span>
                            <input type="text" value="æˆäººå†…å®¹" placeholder="åˆ†ç±»åç§°" class="category-name">
                            <span>|</span>
                            <input type="text" value="adult,porn,è‰²æƒ…,æˆäºº,18+,xxx,$adult,$porn" placeholder="å…³é”®è¯" class="category-keys">
                        </div>
                        <div class="category-item">
                            <span>ğŸ°</span>
                            <input type="text" value="èµŒåšç½‘ç«™" placeholder="åˆ†ç±»åç§°" class="category-name">
                            <span>|</span>
                            <input type="text" value="gambling,èµŒåš,å½©ç¥¨,åšå½©,èµŒåœº,$gambling,$lottery" placeholder="å…³é”®è¯" class="category-keys">
                        </div>
                    </div>
                </div>
                
                <!-- 5. éšç§ä¿æŠ¤åˆ†ç±»ç»„ -->
                <div class="category-group">
                    <h4>ğŸ”’ éšç§ä¿æŠ¤</h4>
                    <div class="category-list" id="categoryListPrivacy">
                        <div class="category-item">
                            <span>ğŸ“Š</span>
                            <input type="text" value="æ•°æ®æ”¶é›†" placeholder="åˆ†ç±»åç§°" class="category-name">
                            <span>|</span>
                            <input type="text" value="data,collect,æ”¶é›†,æ•°æ®,éšç§,$privacy,$datacollect" placeholder="å…³é”®è¯" class="category-keys">
                        </div>
                        <div class="category-item">
                            <span>ğŸ–ï¸</span>
                            <input type="text" value="æŒ‡çº¹è¿½è¸ª" placeholder="åˆ†ç±»åç§°" class="category-name">
                            <span>|</span>
                            <input type="text" value="fingerprint,æŒ‡çº¹,è®¾å¤‡æŒ‡çº¹,è¿½è¸ª,$fingerprint,$deviceid" placeholder="å…³é”®è¯" class="category-keys">
                        </div>
                    </div>
                </div>
                
                <!-- 6. åª’ä½“å†…å®¹åˆ†ç±»ç»„ -->
                <div class="category-group">
                    <h4>ğŸ¬ åª’ä½“å†…å®¹</h4>
                    <div class="category-list" id="categoryListMedia">
                        <div class="category-item">
                            <span>ğŸ“º</span>
                            <input type="text" value="è§†é¢‘å¹¿å‘Š" placeholder="åˆ†ç±»åç§°" class="category-name">
                            <span>|</span>
                            <input type="text" value="video ad,è§†é¢‘å¹¿å‘Š,è´´ç‰‡å¹¿å‘Š,å‰ç½®å¹¿å‘Š,$videoad" placeholder="å…³é”®è¯" class="category-keys">
                        </div>
                        <div class="category-item">
                            <span>ğŸ¥</span>
                            <input type="text" value="æµåª’ä½“" placeholder="åˆ†ç±»åç§°" class="category-name">
                            <span>|</span>
                            <input type="text" value="stream,æµåª’ä½“,è§†é¢‘,éŸ³é¢‘,youtube,æŠ–éŸ³,å¿«æ‰‹,$stream,$video" placeholder="å…³é”®è¯" class="category-keys">
                        </div>
                    </div>
                </div>
                
                <!-- 7. ä¿¡æ¯è·å–åˆ†ç±»ç»„ -->
                <div class="category-group">
                    <h4>ğŸ” ä¿¡æ¯è·å–</h4>
                    <div class="category-list" id="categoryListInfo">
                        <div class="category-item">
                            <span>ğŸ”</span>
                            <input type="text" value="æœç´¢å¼•æ“" placeholder="åˆ†ç±»åç§°" class="category-name">
                            <span>|</span>
                            <input type="text" value="search,baidu,ç™¾åº¦,google,è°·æ­Œ,bing,æœç´¢,$search" placeholder="å…³é”®è¯" class="category-keys">
                        </div>
                        <div class="category-item">
                            <span>ğŸ“°</span>
                            <input type="text" value="æ–°é—»åª’ä½“" placeholder="åˆ†ç±»åç§°" class="category-name">
                            <span>|</span>
                            <input type="text" value="news,æ–°é—»,åª’ä½“,èµ„è®¯,å¤´æ¡,$news,$media" placeholder="å…³é”®è¯" class="category-keys">
                        </div>
                    </div>
                </div>
                
                <!-- 8. ç³»ç»Ÿç›¸å…³åˆ†ç±»ç»„ -->
                <div class="category-group">
                    <h4>ğŸ–¥ï¸ ç³»ç»Ÿç›¸å…³</h4>
                    <div class="category-list" id="categoryListSystem">
                        <div class="category-item">
                            <span>ğŸ”„</span>
                            <input type="text" value="ç³»ç»Ÿæ›´æ–°" placeholder="åˆ†ç±»åç§°" class="category-name">
                            <span>|</span>
                            <input type="text" value="update,å‡çº§,æ›´æ–°,ç³»ç»Ÿæ›´æ–°,$update,$upgrade" placeholder="å…³é”®è¯" class="category-keys">
                        </div>
                        <div class="category-item">
                            <span>ğŸ“¡</span>
                            <input type="text" value="é¥æµ‹æ•°æ®" placeholder="åˆ†ç±»åç§°" class="category-name">
                            <span>|</span>
                            <input type="text" value="telemetry,é¥æµ‹,æ•°æ®ä¸ŠæŠ¥,è¯Šæ–­,$telemetry,$diagnostic" placeholder="å…³é”®è¯" class="category-keys">
                        </div>
                    </div>
                </div>
                
                <!-- 9. åœ°åŒºç‰¹å®šåˆ†ç±»ç»„ -->
                <div class="category-group">
                    <h4>ğŸŒ åœ°åŒºç‰¹å®š</h4>
                    <div class="category-list" id="categoryListRegion">
                        <div class="category-item">
                            <span>ğŸ‡¨ğŸ‡³</span>
                            <input type="text" value="ä¸­å›½ç½‘ç«™" placeholder="åˆ†ç±»åç§°" class="category-name">
                            <span>|</span>
                            <input type="text" value=".cn,ä¸­å›½,å¤§é™†,é¦™æ¸¯,å°æ¹¾,ç™¾åº¦,è…¾è®¯,é˜¿é‡Œ,$cn,$china" placeholder="å…³é”®è¯" class="category-keys">
                        </div>
                        <div class="category-item">
                            <span>ğŸ‡·ğŸ‡º</span>
                            <input type="text" value="ä¿„ç½—æ–¯ç½‘ç«™" placeholder="åˆ†ç±»åç§°" class="category-name">
                            <span>|</span>
                            <input type="text" value=".ru,ä¿„ç½—æ–¯,ä¿„æ–‡,russia,$ru,$russian" placeholder="å…³é”®è¯" class="category-keys">
                        </div>
                    </div>
                </div>
                
                <!-- 10. é€šç”¨åˆ†ç±»ç»„ -->
                <div class="category-group">
                    <h4>ğŸ”§ é€šç”¨</h4>
                    <div class="category-list" id="categoryListGeneral">
                        <div class="category-item">
                            <span>ğŸ”§</span>
                            <input type="text" value="é€šç”¨è§„åˆ™" placeholder="åˆ†ç±»åç§°" class="category-name">
                            <span>|</span>
                            <input type="text" value="general,é€šç”¨,åŸºç¡€,é»˜è®¤,$general,$basic" placeholder="å…³é”®è¯" class="category-keys">
                        </div>
                    </div>
                </div>
                
                <!-- è‡ªå®šä¹‰åˆ†ç±»æŒ‰é’® -->
                <button class="add-category-btn" id="addCategoryBtn">+ æ·»åŠ è‡ªå®šä¹‰è§„åˆ™åˆ†ç±»</button>
                <!-- è‡ªå®šä¹‰åˆ†ç±»å®¹å™¨ -->
                <div class="category-group" style="margin-top: 15px;">
                    <h4>âœï¸ è‡ªå®šä¹‰åˆ†ç±»</h4>
                    <div class="category-list" id="categoryListCustom"></div>
                </div>
            </div>
            
            <div class="progress-container">
                <div class="progress-bar" id="progressBar">0%</div>
            </div>
            
            <div style="display: flex; gap: 10px;">
                <button class="btn" id="processBtn" disabled>å¼€å§‹å¤„ç†è§„åˆ™æ–‡ä»¶</button>
                <button class="btn" id="resetBtn">é‡ç½®</button>
                <button class="btn" id="downloadBtn" disabled>ä¸‹è½½åˆ†ç±»åè§„åˆ™</button>
            </div>
            
            <div class="stats">
                <div class="stat-item">
                    <div class="stat-number" id="totalLines">0</div>
                    <div class="stat-label">åˆå¹¶åæ€»è§„åˆ™æ•°</div>
                </div>
                <div class="stat-item">
                    <div class="stat-number" id="processedLines">0</div>
                    <div class="stat-label">å¤„ç†åè§„åˆ™æ•°</div>
                </div>
                <div class="stat-item">
                    <div class="stat-number" id="removedLines">0</div>
                    <div class="stat-label">åˆ é™¤è¡Œæ•°ï¼ˆæ³¨é‡Š/ç©ºè¡Œï¼‰</div>
                </div>
                <div class="stat-item">
                    <div class="stat-number" id="categoryCount">0</div>
                    <div class="stat-label">è§„åˆ™åˆ†ç±»æ•°é‡</div>
                </div>
            </div>
            
            <div class="search-container">
                <input type="text" id="searchInput" class="search-input" placeholder="æœç´¢è§„åˆ™ï¼ˆæ”¯æŒåŸŸå/å…³é”®è¯ï¼‰...">
                <select id="searchType" class="search-type">
                    <option value="fuzzy">æ¨¡ç³Šæœç´¢ï¼ˆåŸŸå/å†…å®¹ï¼‰</option>
                    <option value="exact">ç²¾ç¡®åŒ¹é…è§„åˆ™</option>
                </select>
                <button class="btn" id="searchBtn">æœç´¢</button>
                <button class="btn" id="clearSearchBtn">æ¸…é™¤æœç´¢</button>
                <span id="searchResults"></span>
            </div>
        </div>
        
        <div class="content-display">
            <div class="content-panel">
                <div class="panel-header">åˆå¹¶ååŸå§‹è§„åˆ™</div>
                <div class="content-area" id="originalContent"></div>
            </div>
            
            <div class="content-panel">
                <div class="panel-header">åˆ é™¤çš„å†…å®¹ï¼ˆæ³¨é‡Š/é‡å¤/ç©ºè¡Œï¼‰</div>
                <div class="content-area" id="removedContent"></div>
            </div>
            
            <div class="content-panel">
                <div class="panel-header">ç²¾ç»†åŒ–åˆ†ç±»æ•´ç†åAdGuardè§„åˆ™</div>
                <div class="content-area" id="processedContent"></div>
            </div>
        </div>
        
        <footer>
            <p>AdGuard DNSè§„åˆ™æ•´ç†å·¥å…·ï¼ˆç²¾ç»†åŒ–åˆ†ç±»ç‰ˆï¼‰ &copy; 2025 | å®Œå…¨åœ¨æµè§ˆå™¨ä¸­è¿è¡Œï¼Œä¸ä¸Šä¼ ä»»ä½•æ•°æ®åˆ°æœåŠ¡å™¨</p>
            <p>æ”¯æŒåå¤§ç±»ç²¾ç»†åŒ–åˆ†ç±»ï¼šå¹¿å‘Šä¸è·Ÿè¸ª/ç¤¾äº¤åª’ä½“/å®‰å…¨é˜²æŠ¤/å†…å®¹è¿‡æ»¤/éšç§ä¿æŠ¤/åª’ä½“å†…å®¹/ä¿¡æ¯è·å–/ç³»ç»Ÿç›¸å…³/åœ°åŒºç‰¹å®š/é€šç”¨</p>
        </footer>
    </div>

    <script>
        // å…¨å±€å˜é‡
        let originalLines = [];      // æ‰€æœ‰æ–‡ä»¶åˆå¹¶åçš„åŸå§‹è§„åˆ™è¡Œ
        let processedLines = [];     // åŸºç¡€å¤„ç†åçš„è§„åˆ™è¡Œï¼ˆå»é‡/å»æ³¨é‡Šç­‰ï¼‰
        let categorizedLines = {};   // åˆ†ç±»åçš„è§„åˆ™ {åˆ†ç±»å: [è§„åˆ™åˆ—è¡¨]}
        let uncategorizedLines = []; // æœªåŒ¹é…åˆ°ä»»ä½•åˆ†ç±»çš„è§„åˆ™
        let removedLines = [];       // åˆ é™¤çš„è¡Œï¼ˆæ³¨é‡Š/é‡å¤/ç©ºè¡Œï¼‰
        let currentSearchMatches = [];
        let currentSearchIndex = -1;
        let selectedFiles = [];      // é€‰ä¸­çš„æ–‡ä»¶åˆ—è¡¨
        
        // DOMå…ƒç´ 
        const fileInput = document.getElementById('fileInput');
        const fileList = document.getElementById('fileList');
        const processBtn = document.getElementById('processBtn');
        const resetBtn = document.getElementById('resetBtn');
        const downloadBtn = document.getElementById('downloadBtn');
        const progressBar = document.getElementById('progressBar');
        const searchInput = document.getElementById('searchInput');
        const searchBtn = document.getElementById('searchBtn');
        const clearSearchBtn = document.getElementById('clearSearchBtn');
        const searchResults = document.getElementById('searchResults');
        const addCategoryBtn = document.getElementById('addCategoryBtn');
        const categoryListCustom = document.getElementById('categoryListCustom');
        
        // æ‰€æœ‰åˆ†ç±»å®¹å™¨IDï¼ˆç”¨äºæ‰¹é‡è¯»å–åˆ†ç±»é…ç½®ï¼‰
        const categoryContainerIds = [
            'categoryListAd', 'categoryListSocial', 'categoryListSecurity',
            'categoryListContent', 'categoryListPrivacy', 'categoryListMedia',
            'categoryListInfo', 'categoryListSystem', 'categoryListRegion',
            'categoryListGeneral', 'categoryListCustom'
        ];
        
        // ç»Ÿè®¡å…ƒç´ 
        const totalLinesEl = document.getElementById('totalLines');
        const processedLinesEl = document.getElementById('processedLines');
        const removedLinesEl = document.getElementById('removedLines');
        const categoryCountEl = document.getElementById('categoryCount');
        
        // å†…å®¹æ˜¾ç¤ºå…ƒç´ 
        const originalContentEl = document.getElementById('originalContent');
        const removedContentEl = document.getElementById('removedContent');
        const processedContentEl = document.getElementById('processedContent');
        
        // æ–‡ä»¶æ‹–æ”¾æ”¯æŒ
        document.addEventListener('dragover', (e) => {
            e.preventDefault();
            e.stopPropagation();
        });
        
        document.addEventListener('drop', (e) => {
            e.preventDefault();
            e.stopPropagation();
            
            const files = Array.from(e.dataTransfer.files).filter(file => 
                ['text/plain', 'application/octet-stream'].includes(file.type) || 
                ['.txt', '.filter', '.rules'].includes(file.name.toLowerCase().slice(-4))
            );
            
            if (files.length > 0) {
                fileInput.files = e.dataTransfer.files;
                handleFileSelect(files);
            } else {
                alert('è¯·é€‰æ‹©AdGuardè§„åˆ™æ–‡ä»¶ï¼ˆæ”¯æŒ.txt/.filter/.rulesæ ¼å¼ï¼‰');
            }
        });
        
        // æ–‡ä»¶é€‰æ‹©äº‹ä»¶
        fileInput.addEventListener('change', (e) => {
            const files = Array.from(e.target.files).filter(file => 
                ['text/plain', 'application/octet-stream'].includes(file.type) || 
                ['.txt', '.filter', '.rules'].includes(file.name.toLowerCase().slice(-4))
            );
            
            if (files.length > 0) {
                handleFileSelect(files);
            } else {
                fileList.textContent = 'æœªé€‰æ‹©æ–‡ä»¶';
                processBtn.disabled = true;
                processBtn.textContent = 'å¼€å§‹å¤„ç†è§„åˆ™æ–‡ä»¶';
            }
        });
        
        // æ·»åŠ è‡ªå®šä¹‰åˆ†ç±»è¡Œ
        addCategoryBtn.addEventListener('click', () => {
            const newItem = document.createElement('div');
            newItem.className = 'category-item';
            newItem.innerHTML = `
                <span>ğŸ“</span>
                <input type="text" placeholder="è‡ªå®šä¹‰åˆ†ç±»åç§°" class="category-name">
                <span>|</span>
                <input type="text" placeholder="åŒ¹é…å…³é”®è¯ï¼ˆé€—å·åˆ†éš”ï¼‰" class="category-keys">
            `;
            categoryListCustom.appendChild(newItem);
        });
        
        // å¤„ç†æ–‡ä»¶é€‰æ‹©
        function handleFileSelect(files) {
            if (!files || files.length === 0) return;
            
            selectedFiles = files;
            
            // æ›´æ–°æ–‡ä»¶åˆ—è¡¨æ˜¾ç¤º
            let fileListHtml = `å·²é€‰æ‹© ${files.length} ä¸ªè§„åˆ™æ–‡ä»¶ï¼š<br>`;
            files.forEach((file, index) => {
                const fileSize = (file.size / 1024).toFixed(2);
                fileListHtml += `${index + 1}. ${file.name} (${fileSize} KB)<br>`;
            });
            fileList.innerHTML = fileListHtml;
            
            // æ›´æ–°æŒ‰é’®çŠ¶æ€
            processBtn.disabled = false;
            processBtn.textContent = `å¤„ç† ${files.length} ä¸ªè§„åˆ™æ–‡ä»¶`;
            
            // æç¤ºä¿¡æ¯
            const totalSize = (files.reduce((sum, file) => sum + file.size, 0) / 1024).toFixed(2);
            alert(`å·²é€‰æ‹© ${files.length} ä¸ªAdGuardè§„åˆ™æ–‡ä»¶ï¼Œæ€»å¤§å°ï¼š${totalSize} KB\nå°†æŒ‰åå¤§ç±»ç²¾ç»†åŒ–åˆ†ç±»æ•´ç†ï¼Œè¯·ç‚¹å‡»"å¼€å§‹å¤„ç†è§„åˆ™æ–‡ä»¶"æŒ‰é’®ã€‚`);
        }
        
        // å¤„ç†æŒ‰é’®äº‹ä»¶ï¼ˆç²¾ç»†åŒ–åˆ†ç±»ç‰ˆï¼‰
        processBtn.addEventListener('click', async () => {
            if (selectedFiles.length === 0) return;
            
            processBtn.disabled = true;
            progressBar.style.width = '0%';
            progressBar.textContent = '0%';
            
            try {
                await processMultipleFiles(selectedFiles);
            } catch (error) {
                console.error('å¤„ç†è§„åˆ™æ–‡ä»¶æ—¶å‡ºé”™:', error);
                alert('å¤„ç†è§„åˆ™æ–‡ä»¶æ—¶å‡ºé”™: ' + error.message);
                processBtn.disabled = false;
            }
        });
        
        // é‡ç½®æŒ‰é’®äº‹ä»¶
        resetBtn.addEventListener('click', () => {
            fileInput.value = '';
            fileList.textContent = 'æœªé€‰æ‹©æ–‡ä»¶';
            processBtn.disabled = true;
            processBtn.textContent = 'å¼€å§‹å¤„ç†è§„åˆ™æ–‡ä»¶';
            downloadBtn.disabled = true;
            selectedFiles = [];
            
            // é‡ç½®UI
            progressBar.style.width = '0%';
            progressBar.textContent = '0%';
            
            originalContentEl.textContent = '';
            removedContentEl.textContent = '';
            processedContentEl.textContent = '';
            
            totalLinesEl.textContent = '0';
            processedLinesEl.textContent = '0';
            removedLinesEl.textContent = '0';
            categoryCountEl.textContent = '0';
            
            searchInput.value = '';
            searchResults.textContent = '';
            
            // é‡ç½®æ•°æ®
            originalLines = [];
            processedLines = [];
            categorizedLines = {};
            uncategorizedLines = [];
            removedLines = [];
            currentSearchMatches = [];
            currentSearchIndex = -1;
            
            // é‡ç½®å¤é€‰æ¡†ï¼ˆé€‚é…AdGuardé»˜è®¤é…ç½®ï¼‰
            document.getElementById('removeDuplicates').checked = true;
            document.getElementById('removeComments').checked = true;
            document.getElementById('sortLines').checked = false;
            document.getElementById('enableCategory').checked = true;
            document.getElementById('trimLines').checked = true;
            document.getElementById('removeEmptyLines').checked = true;
            document.getElementById('keepRuleSyntax').checked = true;
            document.getElementById('sortByCategory').checked = false;
            
            // æ¸…ç©ºè‡ªå®šä¹‰åˆ†ç±»
            categoryListCustom.innerHTML = '';
        });
        
        // ä¸‹è½½æŒ‰é’®äº‹ä»¶ï¼ˆç²¾ç»†åŒ–åˆ†ç±»ç‰ˆï¼‰
        downloadBtn.addEventListener('click', () => {
            if (Object.keys(categorizedLines).length === 0 && uncategorizedLines.length === 0) return;
            
            // æ„å»ºåˆ†ç±»åçš„AdGuardè§„åˆ™å†…å®¹ï¼ˆä¿ç•™#åˆ†ç±»æ ‡é¢˜ï¼Œç¬¦åˆAdGuardæ³¨é‡Šè§„èŒƒï¼‰
            let content = `! AdGuard DNSè§„åˆ™ç²¾ç»†åŒ–åˆ†ç±»ç»“æœ - ${new Date().toLocaleString()}\n`;
            content += `! æ€»è§„åˆ™æ•°ï¼š${processedLines.length} | åˆ†ç±»æ•°ï¼š${Object.keys(categorizedLines).length}\n`;
            content += `! åˆ†ç±»ä½“ç³»ï¼šå¹¿å‘Šä¸è·Ÿè¸ª â†’ ç¤¾äº¤åª’ä½“ â†’ å®‰å…¨é˜²æŠ¤ â†’ å†…å®¹è¿‡æ»¤ â†’ éšç§ä¿æŠ¤ â†’ åª’ä½“å†…å®¹ â†’ ä¿¡æ¯è·å– â†’ ç³»ç»Ÿç›¸å…³ â†’ åœ°åŒºç‰¹å®š â†’ é€šç”¨\n\n`;
            
            const sortByCategory = document.getElementById('sortByCategory').checked;
            // å®šä¹‰åˆ†ç±»æ˜¾ç¤ºé¡ºåºï¼ˆæŒ‰åå¤§ç±»ä¼˜å…ˆçº§ï¼‰
            const categoryDisplayOrder = [
                'å¹¿å‘Šæ‹¦æˆª', 'è·Ÿè¸ªä¿æŠ¤', 'å¼¹çª—å¹¿å‘Š',
                'ç¤¾äº¤åª’ä½“', 'ç¤¾äº¤æ’ä»¶',
                'æ¶æ„è½¯ä»¶', 'é’“é±¼ç½‘ç«™', 'æŒ–çŸ¿è„šæœ¬',
                'æˆäººå†…å®¹', 'èµŒåšç½‘ç«™',
                'æ•°æ®æ”¶é›†', 'æŒ‡çº¹è¿½è¸ª',
                'è§†é¢‘å¹¿å‘Š', 'æµåª’ä½“',
                'æœç´¢å¼•æ“', 'æ–°é—»åª’ä½“',
                'ç³»ç»Ÿæ›´æ–°', 'é¥æµ‹æ•°æ®',
                'ä¸­å›½ç½‘ç«™', 'ä¿„ç½—æ–¯ç½‘ç«™',
                'é€šç”¨è§„åˆ™'
            ];
            
            // å…ˆæŒ‰é¢„è®¾é¡ºåºæ˜¾ç¤ºåˆ†ç±»
            categoryDisplayOrder.forEach(category => {
                if (categorizedLines[category] && categorizedLines[category].length > 0) {
                    content += `! ==============================================\n`;
                    content += `#${category}\n`;
                    content += `! ==============================================\n`;
                    content += categorizedLines[category].join('\n');
                    content += '\n\n';
                }
            });
            
            // æ˜¾ç¤ºè‡ªå®šä¹‰åˆ†ç±»
            Object.keys(categorizedLines).forEach(category => {
                if (!categoryDisplayOrder.includes(category) && categorizedLines[category].length > 0) {
                    content += `! ==============================================\n`;
                    content += `#${category}\n`;
                    content += `! ==============================================\n`;
                    content += categorizedLines[category].join('\n');
                    content += '\n\n';
                }
            });
            
            // æ·»åŠ æœªåˆ†ç±»è§„åˆ™
            if (uncategorizedLines.length > 0) {
                content += `! ==============================================\n`;
                content += `#æœªåˆ†ç±»è§„åˆ™\n`;
                content += `! ==============================================\n`;
                content += uncategorizedLines.join('\n');
                content += '\n';
            }
            
            // ç”ŸæˆBlobï¼ˆUTF-8ç¼–ç ï¼Œé€‚é…AdGuardï¼‰
            const blob = new Blob([content], { 
                type: 'text/plain; charset=utf-8' 
            });
            const url = URL.createObjectURL(blob);
            
            const a = document.createElement('a');
            a.href = url;
            a.download = `AdGuard_Rules_Categorized_${new Date().getTime()}.txt`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        });
        
        // æœç´¢æŒ‰é’®äº‹ä»¶
        searchBtn.addEventListener('click', () => {
            performSearch();
        });
        
        // æ¸…é™¤æœç´¢æŒ‰é’®äº‹ä»¶
        clearSearchBtn.addEventListener('click', () => {
            searchInput.value = '';
            clearSearch();
        });
        
        // å›è½¦é”®æœç´¢
        searchInput.addEventListener('keyup', (e) => {
            if (e.key === 'Enter') {
                performSearch();
            }
        });
        
        // å¤„ç†å¤šä¸ªAdGuardè§„åˆ™æ–‡ä»¶ï¼ˆæ ¸å¿ƒé€»è¾‘ï¼‰
        async function processMultipleFiles(files) {
            originalLines = [];
            const totalFiles = files.length;
            
            // ç¬¬ä¸€æ­¥ï¼šè¯»å–å¹¶åˆå¹¶æ‰€æœ‰è§„åˆ™æ–‡ä»¶ï¼ˆå æ€»è¿›åº¦50%ï¼‰
            for (let i = 0; i < totalFiles; i++) {
                const file = files[i];
                const fileContent = await readFileAsText(file);
                
                // æŒ‰è¡Œåˆ†å‰²ï¼ˆå…¼å®¹Windows/Macæ¢è¡Œç¬¦ï¼‰
                const fileLines = fileContent.split(/\r?\n/);
                originalLines = originalLines.concat(fileLines);
                
                // æ›´æ–°è¯»å–è¿›åº¦
                const readProgress = (i + 1) / totalFiles * 50;
                progressBar.style.width = `${readProgress}%`;
                progressBar.textContent = `${Math.round(readProgress)}%`;
            }
            
            // æ˜¾ç¤ºåˆå¹¶åçš„åŸæ–‡
            displayContent(originalContentEl, originalLines, false);
            totalLinesEl.textContent = originalLines.length;
            
            // ç¬¬äºŒæ­¥ï¼šAdGuardè§„åˆ™åŸºç¡€å¤„ç†ï¼ˆå»é‡/å»æ³¨é‡Šç­‰ï¼Œå 35%è¿›åº¦ï¼‰
            setTimeout(() => {
                processAdGuardRules();
                
                // ç¬¬ä¸‰æ­¥ï¼šç²¾ç»†åŒ–è‡ªåŠ¨åˆ†ç±»å¤„ç†ï¼ˆå 15%è¿›åº¦ï¼‰
                setTimeout(() => {
                    categorizeAdGuardRules();
                    // å®Œæˆè¿›åº¦
                    progressBar.style.width = '100%';
                    progressBar.textContent = '100%';
                    
                    // æ˜¾ç¤ºåˆ†ç±»åçš„è§„åˆ™
                    displayCategorizedContent();
                    
                    // æ›´æ–°ç»Ÿè®¡
                    processedLinesEl.textContent = processedLines.length;
                    removedLinesEl.textContent = removedLines.length;
                    categoryCountEl.textContent = Object.keys(categorizedLines).length + (uncategorizedLines.length > 0 ? 1 : 0);
                    
                    // å¯ç”¨ä¸‹è½½æŒ‰é’®
                    downloadBtn.disabled = false;
                    processBtn.disabled = false;
                    processBtn.textContent = `é‡æ–°å¤„ç† ${selectedFiles.length} ä¸ªè§„åˆ™æ–‡ä»¶`;
                }, 100);
            }, 100);
        }
        
        // å¼‚æ­¥è¯»å–å•ä¸ªæ–‡ä»¶ï¼ˆé€‚é…å¤§è§„åˆ™æ–‡ä»¶ï¼‰
        function readFileAsText(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onload = (e) => resolve(e.target.result);
                reader.onerror = () => reject(new Error(`è¯»å–è§„åˆ™æ–‡ä»¶ ${file.name} å¤±è´¥`));
                reader.readAsText(file, 'utf-8'); // å¼ºåˆ¶UTF-8ï¼Œé€‚é…AdGuardè§„åˆ™
            });
        }
        
        // AdGuardè§„åˆ™åŸºç¡€å¤„ç†ï¼ˆæ ¸å¿ƒé€‚é…é€»è¾‘ï¼‰
        function processAdGuardRules() {
            // è·å–AdGuardä¸“ç”¨é€‰é¡¹
            const removeDuplicates = document.getElementById('removeDuplicates').checked;
            const removeComments = document.getElementById('removeComments').checked;
            const trimLines = document.getElementById('trimLines').checked;
            const removeEmptyLines = document.getElementById('removeEmptyLines').checked;
            const keepRuleSyntax = document.getElementById('keepRuleSyntax').checked;
            const sortLines = document.getElementById('sortLines').checked;
            
            // åˆå§‹åŒ–å˜é‡
            const uniqueSet = new Set();
            processedLines = [];
            removedLines = [];
            
            // å¤„ç†æ¯ä¸€è¡Œè§„åˆ™
            originalLines.forEach((line, index) => {
                // æ¨¡æ‹Ÿå¤„ç†è¿›åº¦
                if (index % 100 === 0) {
                    const processProgress = 50 + (index / originalLines.length * 35);
                    progressBar.style.width = `${processProgress}%`;
                    progressBar.textContent = `${Math.round(processProgress)}%`;
                }
                
                let processedLine = line;
                
                // 1. å»é™¤é¦–å°¾ç©ºæ ¼ï¼ˆä¿ç•™è§„åˆ™å†…çš„å¿…è¦ç©ºæ ¼ï¼‰
                if (trimLines) {
                    processedLine = processedLine.trim();
                }
                
                // 2. è¿‡æ»¤ç©ºè¡Œ
                if (removeEmptyLines && processedLine === '') {
                    removedLines.push(line);
                    return;
                }
                
                // 3. è¿‡æ»¤!å¼€å¤´çš„æ³¨é‡Šè¡Œï¼ˆAdGuardæ³¨é‡Šè§„èŒƒï¼‰
                if (removeComments && processedLine.startsWith('!')) {
                    removedLines.push(line);
                    return;
                }
                
                // 4. å»é‡å¤„ç†ï¼ˆä¿ç•™AdGuardè§„åˆ™è¯­æ³•ç‰¹å¾ï¼‰
                const ruleKey = keepRuleSyntax ? processedLine : extractDomainFromRule(processedLine);
                if (removeDuplicates && uniqueSet.has(ruleKey)) {
                    removedLines.push(line);
                    return;
                }
                
                // 5. ä¿ç•™æœ‰æ•ˆè§„åˆ™
                if (processedLine !== '') {
                    uniqueSet.add(ruleKey);
                    processedLines.push(processedLine);
                }
            });
            
            // 6. æŒ‰åŸŸåæ’åºè§„åˆ™ï¼ˆAdGuardè§„åˆ™ä¸“ç”¨æ’åºï¼‰
            if (sortLines) {
                processedLines.sort((a, b) => {
                    // æå–åŸŸåè¿›è¡Œæ’åºï¼Œè€ŒéåŸå§‹å­—ç¬¦ä¸²
                    const domainA = extractDomainFromRule(a).toLowerCase();
                    const domainB = extractDomainFromRule(b).toLowerCase();
                    return domainA.localeCompare(domainB);
                });
            }
        }
        
        // æå–AdGuardè§„åˆ™ä¸­çš„åŸŸåï¼ˆæ ¸å¿ƒé€‚é…é€»è¾‘ï¼‰
        function extractDomainFromRule(rule) {
            if (!rule || typeof rule !== 'string') return '';
            
            // å¤„ç†å¸¸è§AdGuardè§„åˆ™æ ¼å¼ï¼š
            // ||domain.com^ â†’ domain.com
            // @@||domain.com^ â†’ domain.com
            // domain.com$script â†’ domain.com
            // 1.2.3.4 â†’ 1.2.3.4
            let domain = rule.trim();
            
            // ç§»é™¤ç™½åå•å‰ç¼€ @@
            domain = domain.replace(/^@@/, '');
            // ç§»é™¤ || å‰ç¼€
            domain = domain.replace(/^\|\|/, '');
            // ç§»é™¤ ^ åç¼€
            domain = domain.replace(/\^.*$/, '');
            // ç§»é™¤ $ ä¿®é¥°ç¬¦éƒ¨åˆ†
            domain = domain.replace(/\$.*$/, '');
            // ç§»é™¤ç«¯å£å·
            domain = domain.replace(/:\d+$/, '');
            // ç§»é™¤è·¯å¾„éƒ¨åˆ†
            domain = domain.replace(/\/.*$/, '');
            
            return domain || rule;
        }
        
        // AdGuardè§„åˆ™ç²¾ç»†åŒ–è‡ªåŠ¨åˆ†ç±»æ ¸å¿ƒé€»è¾‘
        function categorizeAdGuardRules() {
            const enableCategory = document.getElementById('enableCategory').checked;
            if (!enableCategory) {
                categorizedLines = { "æœªåˆ†ç±»è§„åˆ™": processedLines };
                uncategorizedLines = [];
                return;
            }
            
            // é‡ç½®åˆ†ç±»æ•°æ®
            categorizedLines = {};
            uncategorizedLines = [];
            
            // æ‰¹é‡è¯»å–æ‰€æœ‰åˆ†ç±»é…ç½®ï¼ˆåå¤§ç±»+è‡ªå®šä¹‰ï¼‰
            const categoryRules = [];
            categoryContainerIds.forEach(containerId => {
                const container = document.getElementById(containerId);
                if (!container) return;
                
                const categoryItems = container.querySelectorAll('.category-item');
                categoryItems.forEach(item => {
                    const nameInput = item.querySelector('.category-name');
                    const keysInput = item.querySelector('.category-keys');
                    
                    const categoryName = nameInput.value.trim();
                    const keyWords = keysInput.value.trim().split(',').map(k => k.trim()).filter(k => k);
                    
                    if (categoryName && keyWords.length > 0) {
                        // æ„å»ºé€‚é…AdGuardçš„åŒ¹é…è§„åˆ™ï¼šæ”¯æŒè§„åˆ™è¯­æ³•ï¼ˆå¦‚@@ã€$adblockï¼‰å’ŒåŸŸåå…³é”®è¯
                        const regexPattern = keyWords.map(key => {
                            // è½¬ä¹‰æ­£åˆ™ç‰¹æ®Šå­—ç¬¦
                            return key.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
                        }).join('|');
                        
                        categoryRules.push({
                            name: categoryName,
                            keys: keyWords,
                            regex: new RegExp(regexPattern, 'i'), // ä¸åŒºåˆ†å¤§å°å†™åŒ¹é…
                            type: getCategoryType(categoryName) // æ ‡è®°åˆ†ç±»ç±»å‹ç”¨äºé«˜äº®
                        });
                    }
                });
            });
            
            // å¯¹æ¯è¡Œè§„åˆ™è¿›è¡Œç²¾ç»†åŒ–åˆ†ç±»åŒ¹é…
            processedLines.forEach(rule => {
                let matched = false;
                
                // ä¼˜å…ˆåŒ¹é…ç‰¹æ®Šè¯­æ³•ï¼ˆç™½åå•@@ã€ä¿®é¥°ç¬¦$ç­‰ï¼‰
                // ç™½åå•è§„åˆ™å•ç‹¬å¤„ç†ï¼ˆé¿å…è¢«å…¶ä»–åˆ†ç±»åŒ¹é…ï¼‰
                if (rule.startsWith('@@')) {
                    // æŸ¥æ‰¾æ˜¯å¦æœ‰ç™½åå•ç›¸å…³åˆ†ç±»
                    const whitelistRule = categoryRules.find(r => 
                        r.name.includes('ç™½åå•') || r.keys.includes('@@') || r.keys.includes('allow')
                    );
                    if (whitelistRule) {
                        if (!categorizedLines[whitelistRule.name]) {
                            categorizedLines[whitelistRule.name] = [];
                        }
                        categorizedLines[whitelistRule.name].push(rule);
                        matched = true;
                    }
                }
                
                // æœªåŒ¹é…åˆ°ç‰¹æ®Šè¯­æ³•ï¼ŒæŒ‰å…³é”®è¯åŒ¹é…
                if (!matched) {
                    // éå†æ‰€æœ‰åˆ†ç±»è§„åˆ™åŒ¹é…
                    for (const ruleItem of categoryRules) {
                        if (ruleItem.regex.test(rule)) {
                            if (!categorizedLines[ruleItem.name]) {
                                categorizedLines[ruleItem.name] = [];
                            }
                            categorizedLines[ruleItem.name].push(rule);
                            matched = true;
                            break; // åŒ¹é…åˆ°ç¬¬ä¸€ä¸ªåˆ†ç±»ååœæ­¢ï¼ˆä¿è¯åˆ†ç±»å‡†ç¡®æ€§ï¼‰
                        }
                    }
                }
                
                // æœªåŒ¹é…åˆ°ä»»ä½•åˆ†ç±»
                if (!matched) {
                    uncategorizedLines.push(rule);
                }
            });
            
            // æŒ‰åˆ†ç±»æ’åºï¼ˆAdGuardè§„åˆ™ä¸“ç”¨ï¼‰
            const sortByCategory = document.getElementById('sortByCategory').checked;
            if (sortByCategory) {
                // å¯¹æ¯ä¸ªåˆ†ç±»å†…çš„è§„åˆ™æŒ‰åŸŸåæ’åº
                Object.keys(categorizedLines).forEach(category => {
                    categorizedLines[category].sort((a, b) => {
                        const domainA = extractDomainFromRule(a).toLowerCase();
                        const domainB = extractDomainFromRule(b).toLowerCase();
                        return domainA.localeCompare(domainB);
                    });
                });
                // å¯¹æœªåˆ†ç±»è§„åˆ™æ’åº
                uncategorizedLines.sort((a, b) => {
                    const domainA = extractDomainFromRule(a).toLowerCase();
                    const domainB = extractDomainFromRule(b).toLowerCase();
                    return domainA.localeCompare(domainB);
                });
            }
        }
        
        // è·å–åˆ†ç±»ç±»å‹ï¼ˆç”¨äºè§„åˆ™é«˜äº®ï¼‰
        function getCategoryType(categoryName) {
            if (categoryName.includes('å¹¿å‘Š') || categoryName.includes('è·Ÿè¸ª') || categoryName.includes('å¼¹çª—')) return 'ad/tracking';
            if (categoryName.includes('ç¤¾äº¤')) return 'social';
            if (categoryName.includes('æ¶æ„') || categoryName.includes('é’“é±¼') || categoryName.includes('æŒ–çŸ¿')) return 'security';
            if (categoryName.includes('æˆäºº') || categoryName.includes('èµŒåš')) return 'content';
            if (categoryName.includes('éšç§') || categoryName.includes('æ•°æ®') || categoryName.includes('æŒ‡çº¹')) return 'privacy';
            if (categoryName.includes('è§†é¢‘') || categoryName.includes('åª’ä½“') || categoryName.includes('æµåª’ä½“')) return 'media';
            if (categoryName.includes('æœç´¢') || categoryName.includes('æ–°é—»')) return 'info';
            if (categoryName.includes('ç³»ç»Ÿ') || categoryName.includes('æ›´æ–°') || categoryName.includes('é¥æµ‹')) return 'system';
            if (categoryName.includes('ä¸­å›½') || categoryName.includes('ä¿„ç½—æ–¯') || categoryName.includes('åœ°åŒº')) return 'region';
            return 'general';
        }
        
        // æ˜¾ç¤ºç²¾ç»†åŒ–åˆ†ç±»åçš„AdGuardè§„åˆ™
        function displayCategorizedContent() {
            processedContentEl.innerHTML = '';
            const fragment = document.createDocumentFragment();
            
            // å®šä¹‰åˆ†ç±»æ˜¾ç¤ºé¡ºåºï¼ˆæŒ‰åå¤§ç±»ä¼˜å…ˆçº§ï¼‰
            const categoryDisplayOrder = [
                'å¹¿å‘Šæ‹¦æˆª', 'è·Ÿè¸ªä¿æŠ¤', 'å¼¹çª—å¹¿å‘Š',
                'ç¤¾äº¤åª’ä½“', 'ç¤¾äº¤æ’ä»¶',
                'æ¶æ„è½¯ä»¶', 'é’“é±¼ç½‘ç«™', 'æŒ–çŸ¿è„šæœ¬',
                'æˆäººå†…å®¹', 'èµŒåšç½‘ç«™',
                'æ•°æ®æ”¶é›†', 'æŒ‡çº¹è¿½è¸ª',
                'è§†é¢‘å¹¿å‘Š', 'æµåª’ä½“',
                'æœç´¢å¼•æ“', 'æ–°é—»åª’ä½“',
                'ç³»ç»Ÿæ›´æ–°', 'é¥æµ‹æ•°æ®',
                'ä¸­å›½ç½‘ç«™', 'ä¿„ç½—æ–¯ç½‘ç«™',
                'é€šç”¨è§„åˆ™'
            ];
            
            // æ·»åŠ é¢„è®¾åˆ†ç±»å†…å®¹
            categoryDisplayOrder.forEach((category, catIndex) => {
                const rules = categorizedLines[category];
                if (!rules || rules.length === 0) return;
                
                // æ·»åŠ åˆ†ç±»æ ‡é¢˜ï¼ˆ#å¼€å¤´ï¼Œé€‚é…AdGuardæ³¨é‡Šï¼‰
                const categoryTitle = document.createElement('div');
                categoryTitle.className = 'category-title';
                categoryTitle.textContent = `#${category} (å…±${rules.length}æ¡è§„åˆ™)`;
                fragment.appendChild(categoryTitle);
                
                // æ·»åŠ åˆ†ç±»ä¸‹çš„è§„åˆ™ï¼ˆæŒ‰ç±»å‹é«˜äº®ï¼‰
                rules.forEach((rule, index) => {
                    const ruleEl = document.createElement('div');
                    
                    // æ ¹æ®åˆ†ç±»ç±»å‹æ·»åŠ æ ·å¼ç±»
                    const categoryType = getCategoryType(category);
                    if (categoryType === 'ad/tracking') ruleEl.className = rule.includes('è·Ÿè¸ª') ? 'rule-tracking' : 'rule-ad';
                    else if (categoryType === 'social') ruleEl.className = 'rule-social';
                    else if (categoryType === 'security') ruleEl.className = 'rule-security';
                    else if (categoryType === 'content') ruleEl.className = 'rule-content';
                    else if (categoryType === 'privacy') ruleEl.className = 'rule-privacy';
                    else if (categoryType === 'media') ruleEl.className = 'rule-media';
                    else if (categoryType === 'info') ruleEl.className = 'rule-info';
                    else if (categoryType === 'system') ruleEl.className = 'rule-system';
                    else if (categoryType === 'region') ruleEl.className = 'rule-region';
                    else ruleEl.className = 'rule-general';
                    
                    ruleEl.textContent = `${index + 1}. ${rule}`;
                    fragment.appendChild(ruleEl);
                });
            });
            
            // æ·»åŠ è‡ªå®šä¹‰åˆ†ç±»å†…å®¹
            Object.keys(categorizedLines).forEach(category => {
                if (!categoryDisplayOrder.includes(category) && categorizedLines[category].length > 0) {
                    const categoryTitle = document.createElement('div');
                    categoryTitle.className = 'category-title';
                    categoryTitle.textContent = `#${category} (å…±${categorizedLines[category].length}æ¡è§„åˆ™)`;
                    fragment.appendChild(categoryTitle);
                    
                    categorizedLines[category].forEach((rule, index) => {
                        const ruleEl = document.createElement('div');
                        ruleEl.className = 'rule-general';
                        ruleEl.textContent = `${index + 1}. ${rule}`;
                        fragment.appendChild(ruleEl);
                    });
                }
            });
            
            // æ·»åŠ æœªåˆ†ç±»è§„åˆ™
            if (uncategorizedLines.length > 0) {
                const uncatTitle = document.createElement('div');
                uncatTitle.className = 'category-title';
                uncatTitle.textContent = `#æœªåˆ†ç±»è§„åˆ™ (å…±${uncategorizedLines.length}æ¡)`;
                fragment.appendChild(uncatTitle);
                
                uncategorizedLines.forEach((rule, index) => {
                    const ruleEl = document.createElement('div');
                    ruleEl.textContent = `${index + 1}. ${rule}`;
                    fragment.appendChild(ruleEl);
                });
            }
            
            processedContentEl.appendChild(fragment);
            
            // æ˜¾ç¤ºåˆ é™¤çš„å†…å®¹
            displayContent(removedContentEl, removedLines, false);
        }
        
        // é€šç”¨å†…å®¹æ˜¾ç¤ºå‡½æ•°ï¼ˆé€‚é…å¤§è§„åˆ™æ–‡ä»¶ï¼‰
        function displayContent(element, lines, isCategorized = true) {
            element.innerHTML = '';
            
            if (lines.length === 0) {
                element.textContent = 'æ— å†…å®¹';
                return;
            }
            
            // ä¼˜åŒ–å¤§è§„åˆ™æ–‡ä»¶æ¸²æŸ“æ€§èƒ½ï¼šåˆ†æ‰¹æ·»åŠ DOMå…ƒç´ 
            const batchSize = 500; // AdGuardè§„åˆ™æ–‡ä»¶é€šå¸¸è¾ƒå¤§ï¼Œå‡å°æ‰¹æ¬¡
            let currentIndex = 0;
            
            function addBatch() {
                const fragment = document.createDocumentFragment();
                const endIndex = Math.min(currentIndex + batchSize, lines.length);
                
                for (let i = currentIndex; i < endIndex; i++) {
                    const lineEl = document.createElement('div');
                    lineEl.textContent = `${i + 1}. ${lines[i]}`;
                    fragment.appendChild(lineEl);
                }
                
                element.appendChild(fragment);
                currentIndex = endIndex;
                
                if (currentIndex < lines.length) {
                    requestAnimationFrame(addBatch);
                }
            }
            
            addBatch();
        }
        
        // æ‰§è¡Œæœç´¢ï¼ˆé€‚é…ç²¾ç»†åŒ–åˆ†ç±»ï¼‰
        function performSearch() {
            const searchTerm = searchInput.value.trim();
            if (!searchTerm) {
                clearSearch();
                return;
            }
            
            const searchType = document.getElementById('searchType').value;
            const processedContent = processedContentEl;
            
            // æ¸…é™¤ä¹‹å‰çš„æœç´¢é«˜äº®
            clearSearch();
            
            // æœç´¢åŒ¹é…çš„è§„åˆ™
            currentSearchMatches = [];
            
            // éå†æ‰€æœ‰è§„åˆ™å…ƒç´ 
            const lineElements = processedContent.querySelectorAll('div');
            lineElements.forEach((lineEl, index) => {
                // è·³è¿‡åˆ†ç±»æ ‡é¢˜
                if (lineEl.classList.contains('category-title')) return;
                
                const lineText = lineEl.textContent.substring(lineEl.textContent.indexOf('. ') + 2);
                const domainText = extractDomainFromRule(lineText); // æå–åŸŸåç”¨äºæœç´¢
                
                let isMatch = false;
                if (searchType === 'exact') {
                    isMatch = lineText === searchTerm;
                } else {
                    // æ¨¡ç³Šæœç´¢ï¼šæ”¯æŒè§„åˆ™å†…å®¹æˆ–åŸŸååŒ¹é…
                    isMatch = lineText.toLowerCase().includes(searchTerm.toLowerCase()) || 
                              domainText.toLowerCase().includes(searchTerm.toLowerCase());
                }
                
                if (isMatch) {
                    currentSearchMatches.push(index);
                    
                    // é«˜äº®æ˜¾ç¤ºåŒ¹é…çš„å†…å®¹
                    const regex = new RegExp(searchTerm.replace(/[.*+?^${}()|[\]\\]/g, '\\$&'), 'gi');
                    const highlightedText = lineText.replace(regex, match => `<span class="highlight">${match}</span>`);
                    lineEl.innerHTML = `${lineEl.textContent.substring(0, lineEl.textContent.indexOf('. ') + 2)}${highlightedText}`;
                }
            });
            
            // æ˜¾ç¤ºæœç´¢ç»“æœ
            if (currentSearchMatches.length > 0) {
                searchResults.innerHTML = `<span class="match-count">æ‰¾åˆ° ${currentSearchMatches.length} ä¸ªåŒ¹é…è§„åˆ™</span>`;
                currentSearchIndex = 0;
                scrollToMatch(currentSearchIndex);
            } else {
                searchResults.textContent = 'æœªæ‰¾åˆ°åŒ¹é…è§„åˆ™';
            }
        }
        
        // æ¸…é™¤æœç´¢é«˜äº®
        function clearSearch() {
            const processedContent = processedContentEl;
            const lineElements = processedContent.querySelectorAll('div');
            
            lineElements.forEach((lineEl, index) => {
                if (lineEl.classList.contains('category-title')) return;
                
                const lineText = lineEl.textContent.substring(lineEl.textContent.indexOf('. ') + 2);
                lineEl.innerHTML = `${index + 1}. ${lineText}`;
                
                // æ¢å¤è§„åˆ™ç±»å‹æ ·å¼
                const classList = lineEl.className;
                if (classList) lineEl.className = classList;
            });
            
            currentSearchMatches = [];
            currentSearchIndex = -1;
            searchResults.textContent = '';
        }
        
        // æ»šåŠ¨åˆ°åŒ¹é…è§„åˆ™
        function scrollToMatch(index) {
            if (currentSearchMatches.length === 0 || index < 0 || index >= currentSearchMatches.length) return;
            
            const processedContent = processedContentEl;
            const lineElements = processedContent.querySelectorAll('div');
            const matchIndex = currentSearchMatches[index];
            
            if (lineElements[matchIndex]) {
                lineElements[matchIndex].scrollIntoView({ behavior: 'smooth', block: 'center' });
                
                // é«˜äº®å½“å‰åŒ¹é…é¡¹
                lineElements.forEach((el, i) => {
                    if (el.classList.contains('category-title')) return;
                    el.style.backgroundColor = i === matchIndex ? '#e1f5fe' : '';
                });
            }
        }
        
        // åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', () => {
            // æ·»åŠ AdGuardç¤ºä¾‹æŒ‰é’®
            addExampleFileOption();
        });
        
        // æ·»åŠ AdGuardç¤ºä¾‹æ–‡ä»¶é€‰é¡¹
        function addExampleFileOption() {
            const fileUploadDiv = document.querySelector('.file-upload');
            const exampleBtn = document.createElement('button');
            exampleBtn.className = 'btn';
            exampleBtn.style.marginTop = '10px';
            exampleBtn.style.backgroundColor = '#27ae60';
            exampleBtn.textContent = 'åŠ è½½ç²¾ç»†åŒ–åˆ†ç±»ç¤ºä¾‹è§„åˆ™æ¼”ç¤º';
            exampleBtn.addEventListener('click', loadExampleFiles);
            fileUploadDiv.appendChild(exampleBtn);
        }
        
        // åŠ è½½ç²¾ç»†åŒ–åˆ†ç±»ç¤ºä¾‹è§„åˆ™æ–‡ä»¶
        function loadExampleFiles() {
            // åŒ…å«åå¤§ç±»è§„åˆ™çš„ç¤ºä¾‹å†…å®¹
            const content1 = `! AdGuardè§„åˆ™ç¤ºä¾‹
||ad.douyin.com^$adblock
||tracker.qq.com^$tracker
||popup.taobao.com^$popup
||social.weibo.com^$social
||phishing-example.com^$phishing
||mining-crypto.com^$mining
||adult-content.com^$adult
||gambling-site.com^$gambling
||data-collect.baidu.com^$privacy
||fingerprint.aliyun.com^$fingerprint
||video-ad.iqiyi.com^$videoad
||stream.bilibili.com^$stream
||search.baidu.com^$search
||news.163.com^$news
||update.microsoft.com^$update
||telemetry.windows.com^$telemetry
||example.cn^$cn
||example.ru^$ru
||general-rule.com^$general
é‡å¤è§„åˆ™
||ad.douyin.com^$adblock`;
            
            const content2 = `! è¡¥å……ç¤ºä¾‹è§„åˆ™
||ads.kuaishou.com^
||tracking.analytics.com^
||social-plugin.qq.com^
||malware-site.com^
||adult-site.com^
||gambling-china.com^
||data-collect.tencent.com^
||stream.youtube.com^
||news.qq.com^
||update.android.com^
||telemetry.android.com^
||baidu.cn^
||yandex.ru^
æµ‹è¯•æœªåˆ†ç±»è§„åˆ™`;
            
            // åˆ›å»ºç¤ºä¾‹æ–‡ä»¶
            const blob1 = new Blob([content1], { type: 'text/plain' });
            const blob2 = new Blob([content2], { type: 'text/plain' });
            const file1 = new File([blob1], 'AdGuard_Rules_1.txt', { type: 'text/plain' });
            const file2 = new File([blob2], 'AdGuard_Rules_2.txt', { type: 'text/plain' });
            
            // æ¨¡æ‹Ÿæ–‡ä»¶é€‰æ‹©
            const dataTransfer = new DataTransfer();
            dataTransfer.items.add(file1);
            dataTransfer.items.add(file2);
            fileInput.files = dataTransfer.files;
            
            // å¤„ç†æ–‡ä»¶é€‰æ‹©
            handleFileSelect([file1, file2]);
            
            // è‡ªåŠ¨å¤„ç†
            setTimeout(() => {
                processBtn.click();
            }, 500);
        }
    </script>
</body>
</html>
